
  
    

        create or replace transient table DBT_TEST.dbt_test.vehicle_insurance_hub  as
        (/* set yaml_metadata and endset are used for assigning variable ( key value pairs) *//* fromyml() built-in jinja function  assigns values to variables */





/*
In general, Hubs consist of 4 columns, described below.

Primary Key (src_pk)
A primary key (or surrogate key) which is usually a hashed representation of the natural key.

Natural Key / Business Key (src_nk)
This is usually a formal identification for the record, such as a incident ID. Usually called the business key because this value has meaning in business processes such as transactions and events.

Load date (src_ldts)
A load date or load date timestamp. This identifies when the record was first loaded into the database.

Record Source (src_source)
The source for the record.

Refer to following link for additional info https://dbtvault.readthedocs.io/en/latest/tutorial/tut_hubs/
*/

-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT rr."VEHICLE_INSURANCE_HK", rr."VEHICLE_INSURANCE_ID", rr."ETL_LOAD_DATETIME", rr."SOURCE",
           ROW_NUMBER() OVER(
               PARTITION BY rr."VEHICLE_INSURANCE_HK"
               ORDER BY rr."ETL_LOAD_DATETIME"
           ) AS row_number
    FROM DBT_TEST.dbt_test_dbt_test.vehicle_insurance_stage_vw AS rr
    WHERE rr."VEHICLE_INSURANCE_HK" IS NOT NULL
    QUALIFY row_number = 1
),

records_to_insert AS (
    SELECT a."VEHICLE_INSURANCE_HK", a."VEHICLE_INSURANCE_ID", a."ETL_LOAD_DATETIME", a."SOURCE"
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
        );
      
  